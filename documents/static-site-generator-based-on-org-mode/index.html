<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>static site generator based on org mode - org2web</title>
    <meta charset="utf-8" />
    <meta name="author" content="Feng Shu" />
    <link rel="stylesheet" href="http://tumashu.github.com/org2web/media/css/main.css" type="text/css">
  </head>
<body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="http://tumashu.github.com/org2web/">org2web</a> <span class="subtitle">(Static site senerator based on org mode)</span></h1>
        <ul>
          <li><a href="http://tumashu.github.com/org2web/changelog/">Changelog</a></li>
          <li><a href="http://tumashu.github.com/org2web/documents/">Documents</a></li>
          <li><a href="http://tumashu.github.com/org2web/tags/">Tags</a></li>
          <li><a href="http://tumashu.github.com/org2web/about/">About</a></li>
          <li><a href="https://github.com/tumashu/org2web">GitHub</a></li>
          <li><a href="http://tumashu.github.com/org2web/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="tumashu.github.com/org2web">
        </form>
        <img class="avatar" src="http://tumashu.github.com/org2web/media/img/horse.jpg" />
      </header>
    </div>

<div class="content-and-footer">
<div>
<div class="post">
<h1 class="post-title">static site generator based on org mode</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbd844f6">1. org2web README</a>
<ul>
<li><a href="#org55e7eb5">1.1. Installation</a></li>
<li><a href="#orgd0d8437">1.2. Configuration</a></li>
<li><a href="#orge9a0802">1.3. Publication</a></li>
<li><a href="#orge10c6a7">1.4. Dependencies</a></li>
<li><a href="#org0bd4ea5">1.5. Known issues</a></li>
</ul>
</li>
<li><a href="#org4617007">2. 代码说明</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgbd844f6" class="outline-2">
<h2 id="orgbd844f6"><span class="section-number-2">1</span> org2web README</h2>
<div class="outline-text-2" id="text-1">
<p>
org2web is the new name of org-webpage, the reason of renaming org-webpage to org2web
is: <a href="https://github.com/purcell/package-lint/issues/75">https://github.com/purcell/package-lint/issues/75</a>
</p>

<p>
org2web is a static site generator based on <a href="http://orgmode.org/">org-mode</a>,
which code derived from Kelvin H's <a href="https://github.com/kelvinh/org-page">org-page</a>.
</p>

<p>
The main differents of two projects are as follow:
</p>

<ol class="org-ol">
<li><p>
org2web's core <b>don't hard code git</b>, its process is like below:
</p>
<pre class="example">

[ Org files in repository]  [ Website project configure ]

             |                           |
        &lt; Export &gt;                 &lt; Generate &gt;
             |                           |

       [ HTML files ]               [ Uploader ]  &lt;- ( Uploader is a bash script )

             |                           |
             |                           |
             +-------------+-------------+
                           |
                           |
                   &lt; Run Uploader &gt;  &lt;- ( For example: git uploader, rclone uploader or others )
                           |
                           |

                       [ REMOTE ]
</pre></li>

<li>org2web's default config is `org-publish-project-alist' style alist,
which can manage multi-site configs in an emacs session easily.</li>
<li>org-website find theme-files from a <b>themes-list</b> in sequence and same theme-file
first found will be used. User can set <b>fallback theme</b> with the help of this feature.</li>
<li>org-website include a tiny emacs web server, which can be used to test publish.</li>
<li>org-website can use other uploaders to upload website, for example: rclone.</li>
<li>&#x2026;</li>
</ol>
</div>

<div id="outline-container-org55e7eb5" class="outline-3">
<h3 id="org55e7eb5"><span class="section-number-3">1.1</span> Installation</h3>
<div class="outline-text-3" id="text-1-1">
<p>
org2web is now available from the famous emacs package repo <a href="http://melpa.milkbox.net/">melpa</a>
so the recommended way is to install it through emacs package
management system. For more info about installation, please see
<b>tips.org</b> in the "doc" folder.
</p>
</div>
</div>

<div id="outline-container-orgd0d8437" class="outline-3">
<h3 id="orgd0d8437"><span class="section-number-3">1.2</span> Configuration</h3>
<div class="outline-text-3" id="text-1-2">
<p>
org2web use variable `org2web-projects' to store all projects's configures, user
can add a project with the help of `add-to-list' function, but the easiest way is
using `org2web-add-project' function.
</p>

<p>
The follow code is <a href="http://tumashu.github.com">my website</a>'s <a href="https://github.com/tumashu/tumashu.github.com/blob/source/eh-website.el">config</a>,
you can adjust and paste it to your <code>.emacs</code> file:
</p>

<pre class="example">
(add-to-list 'load-path "path/to/org2web") ; Only needed if you install org2web manually

(require 'org2web)

(org2web-add-project
 '("tumashu.github.com"
   :repository-directory "~/project/emacs-packages/tumashu.github.com"
   :remote (git "https://github.com/tumashu/tumashu.github.com.git" "master")
   ;; you can use `rclone` with `:remote (rclone "remote-name" "/remote/path/location")` instead.
   :site-domain "http://tumashu.github.com/"
   :site-main-title "Tumashu 的个人小站"
   :site-sub-title "(九天十地，太上忘情！！！)"
   :theme (worg)
   :source-browse-url ("Github" "https://github.com/tumashu/tumashu.github.com")
   :personal-avatar "/media/img/horse.jpg"
   :personal-duoshuo-shortname "tumashu-website"
   :web-server-port 7654))
</pre>

<p>
<a href="https://github.com/tumashu/pyim">pyim</a> 's org2web <a href="https://github.com/tumashu/pyim/blob/master/pyim-devtools.el">config</a> is a more complex example.
</p>

<p>
You can find more config options and theirs default values by commands:
</p>

<pre class="example">
C-h v org2web-projects
C-h v org2web-config-fallback
</pre>
</div>
</div>

<div id="outline-container-orge9a0802" class="outline-3">
<h3 id="orge9a0802"><span class="section-number-3">1.3</span> Publication</h3>
<div class="outline-text-3" id="text-1-3">
<pre class="example">
M-x org2web-publish
</pre>
</div>
</div>

<div id="outline-container-orge10c6a7" class="outline-3">
<h3 id="orge10c6a7"><span class="section-number-3">1.4</span> Dependencies</h3>
<div class="outline-text-3" id="text-1-4">
<ol class="org-ol">
<li><a href="http://www.gnu.org/software/emacs/">emacs</a>: this is an "of-course" dependency</li>
<li><a href="http://orgmode.org/">org mode</a>: v8.0 is required, please use <code>M-x org-version &lt;RET&gt;</code> to make sure you org mode version is not less than 8.0</li>
<li><a href="http://www.gnu.org/software/bash/">bash</a>: the GNU Project's shell</li>
<li><a href="http://git-scm.com">git</a>: a free and open source version control system</li>
<li><a href="http://rclone.org/downloads/">rclone</a>: support to other remote locations, see rclone's overview for more information. (Optional)</li>
<li><a href="https://github.com/Wilfred/mustache.el">mustache.el</a>: a mustache templating library for Emacs</li>
<li><a href="http://fly.srk.fer.hr/~hniksic/emacs/htmlize.el.cgi">htmlize.el</a>: a library for syntax highlighting (usually this library is shipped with emacs)</li>
<li><a href="https://github.com/magnars/dash.el">dash.el</a>: a modern list library for Emacs</li>
<li><a href="https://github.com/Wilfred/ht.el">ht.el</a>: a modern hash-table library for Emacs</li>
<li><a href="https://github.com/skeeto/emacs-web-server">simple-httpd</a>: Extensible Emacs HTTP 1.1 server</li>
</ol>
</div>
</div>

<div id="outline-container-org0bd4ea5" class="outline-3">
<h3 id="org0bd4ea5"><span class="section-number-3">1.5</span> Known issues</h3>
<div class="outline-text-3" id="text-1-5">
<ol class="org-ol">
<li>Currently the deletion change handler has not been implemented so
if you deleted some org sources, you may have to manually delete
corresponding generated html files.</li>
<li>URI path change detection is not available. That is, if you make a
post with the URI "/blog/2013/03/25/the-old-post-name" and then
change this value in your org source, org2web would be unable to
detect that this has happened. it will only publish a new html
file for you so you need to delete the old html file related to
the old URI manually.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org4617007" class="outline-2">
<h2 id="org4617007"><span class="section-number-2">2</span> 代码说明</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">cl-lib</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">ox</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">ht</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-util</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-vars</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-config</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-resource</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-export</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-webserver</span>)
(<span style="color: #4c83ff;">require</span> '<span style="color: #96CBFE;">org2web-el2org</span>)
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defconst</span> <span style="color: #ff69b4;">org2web-version</span> <span style="color: #61CE3C;">"0.1"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-add-project</span> (project-config)
  <span style="color: #FBDE2D;">"Add `</span><span style="color: #96CBFE;">project-config</span><span style="color: #FBDE2D;">' to `</span><span style="color: #96CBFE;">org2web-projects</span><span style="color: #FBDE2D;">'"</span>
  (<span style="color: #4c83ff;">if</span> (listp project-config)
      (<span style="color: #4c83ff;">let</span> ((project-name (car project-config)))
        (<span style="color: #4c83ff;">when</span> (stringp project-name)
          (<span style="color: #4c83ff;">setq</span> org2web-projects
                (remove (assoc project-name org2web-projects)
                        org2web-projects)))
        (add-to-list 'org2web-projects project-config))
    (message <span style="color: #61CE3C;">"Invalid project config!"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-select-project</span> (prompt <span style="color: #afd8af;">&amp;optional</span> project-name)
  <span style="color: #FBDE2D;">"Let user select a project then return its name."</span>
  (<span style="color: #4c83ff;">setq</span> org2web-current-project nil)
  (<span style="color: #4c83ff;">setq</span> project-name
        (<span style="color: #4c83ff;">or</span> project-name
            org2web-default-project
            (completing-read prompt
                             (delete-dups
                              (mapcar 'car org2web-projects))
                             nil t nil nil org2web-last-project)))
  (<span style="color: #4c83ff;">setq</span> org2web-current-project project-name
        org2web-last-project project-name)
  project-name)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-publish</span> (<span style="color: #afd8af;">&amp;optional</span> project-name publishing-directory job-number update-top-n)
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">setq</span> project-name (org2web-select-project <span style="color: #61CE3C;">"Which project do you want to publish? "</span> project-name))
  (<span style="color: #4c83ff;">setq</span> org2web-item-cache nil)

  (org2web-verify-configuration)
  (<span style="color: #4c83ff;">let*</span> ((remote (org2web-get-config-option <span style="color: #4c83ff;">:remote</span>))
         (uploader-config (cdr (assoc (nth 0 remote) org2web-uploaders)))
         (support-partial-update (plist-get uploader-config <span style="color: #4c83ff;">:support-partial-update</span>))
         (jobs (<span style="color: #4c83ff;">if</span> support-partial-update
                   '((1 . <span style="color: #61CE3C;">"Full publish"</span>)
                     (2 . <span style="color: #61CE3C;">"Partial publish"</span>)
                     (3 . <span style="color: #61CE3C;">"Test full publish"</span>)
                     (4 . <span style="color: #61CE3C;">"Test partial publish"</span>)
                     (5 . <span style="color: #61CE3C;">"Upload latest publish"</span>))
                 '((1 . <span style="color: #61CE3C;">"Full publish"</span>)
                   (2 . <span style="color: #61CE3C;">"Test full publish"</span>)
                   (3 . <span style="color: #61CE3C;">"Upload latest publish"</span>))))
         (job-used (completing-read
                    <span style="color: #61CE3C;">"Which job do you want to active: "</span>
                    (mapcar #'cdr jobs)))
         (job-number (car (rassoc job-used jobs)))
         (test-publish (<span style="color: #4c83ff;">if</span> support-partial-update
                           (<span style="color: #4c83ff;">or</span> (= job-number 3)
                               (= job-number 4))
                         (= job-number 2)))
         (partial-update (<span style="color: #4c83ff;">and</span> support-partial-update
                              (<span style="color: #4c83ff;">or</span> (= job-number 2)
                                  (= job-number 4))))
         (upload-latest-publish (<span style="color: #4c83ff;">if</span> support-partial-update
                                    (= job-number 5)
                                  (= job-number 3)))
         (repo-dir (org2web-get-repository-directory))
         (publish-root-dir (org2web-get-uploader-directory project-name))
         (export-dir (org2web-get-uploader-directory project-name <span style="color: #61CE3C;">"export"</span>))
         (history-dir (org2web-get-uploader-directory project-name <span style="color: #61CE3C;">"history"</span>))
         (publishing-directory
          (<span style="color: #4c83ff;">when</span> publishing-directory
            (expand-file-name publishing-directory)))
         (publish-dir
          (<span style="color: #4c83ff;">or</span> publishing-directory
              (org2web-get-uploader-directory project-name <span style="color: #61CE3C;">"publish"</span>)
              (org2web-get-publishing-directory)))
         (test-publish-dir (org2web-get-uploader-directory project-name <span style="color: #61CE3C;">"test-publish"</span>))
         (uploader-file (concat publish-root-dir <span style="color: #61CE3C;">"org2web-uploader.sh"</span>))
         (site-domain (org2web-get-site-domain))
         (preparation-function (org2web-get-config-option <span style="color: #4c83ff;">:preparation-function</span>))
         (repo-files
          (<span style="color: #4c83ff;">unless</span> upload-latest-publish
            (<span style="color: #4c83ff;">when</span> preparation-function
              (run-hooks 'preparation-function))
            (org2web-sort-files (org2web-remove-matched-items
                                 (org2web-directory-files-recursively repo-dir <span style="color: #61CE3C;">"\\.org$"</span>)
                                 (org2web-get-config-option <span style="color: #4c83ff;">:ignore</span>)))))
         (length-repo-files (length repo-files))
         (update-top-n
          (<span style="color: #4c83ff;">cond</span> ((<span style="color: #4c83ff;">and</span> partial-update (numberp update-top-n)) update-top-n)
                (partial-update (org2web-read-top-n
                                 <span style="color: #61CE3C;">"org2web will update TOP (N) org-files, Please type N: "</span>
                                 repo-files repo-dir))))
         (changed-files (<span style="color: #4c83ff;">if</span> (numberp update-top-n)
                            (cl-subseq repo-files 0 (min update-top-n length-repo-files))
                          repo-files)))

    (<span style="color: #4c83ff;">if</span> upload-latest-publish
        (org2web-delete-directory
         history-dir publish-dir test-publish-dir)
      (org2web-delete-directory publish-root-dir)
      (org2web-make-directory export-dir))

    (org2web-make-directory
     history-dir publish-dir test-publish-dir)

    (<span style="color: #4c83ff;">if</span> test-publish
        (<span style="color: #4c83ff;">let</span> ((org2web-always-use-relative-url t) <span style="color: #8B8989; font-style: italic;">; </span><span style="color: #8B8989; font-style: italic;">Local test website, can't use absolute path.</span>
              (port (<span style="color: #4c83ff;">or</span> (org2web-get-config-option <span style="color: #4c83ff;">:web-server-port</span>)
                        (org2web-get-random-number 4))))
          (org2web-prepare-theme-resources test-publish-dir)
          (org2web-publish-changes repo-files changed-files test-publish-dir)
          (org2web-webserver-browse test-publish-dir port))
      (<span style="color: #4c83ff;">unless</span> upload-latest-publish
        (org2web-prepare-theme-resources export-dir)
        (org2web-publish-changes repo-files changed-files export-dir))
      (org2web-generate-and-run-uploader
       uploader-file remote export-dir history-dir publish-dir partial-update))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-generate-and-run-uploader</span> (uploader-file remote export-dir history-dir publish-dir partial-update)
  <span style="color: #FBDE2D;">"Generate shell script UPLOADER-FILE then RUN it, the uploader is used to upload html files</span>
<span style="color: #FBDE2D;">generated by org2web to REMOTE."</span>
  (<span style="color: #4c83ff;">if</span> (not (<span style="color: #4c83ff;">and</span> uploader-file remote export-dir history-dir publish-dir))
      (message <span style="color: #61CE3C;">"Can't generate org2web uploader file."</span>)
    (<span style="color: #4c83ff;">let*</span> ((uploader-name (nth 0 remote))
           (uploader-names (mapcar #'car org2web-uploaders))
           (uploader-config (cdr (assoc uploader-name org2web-uploaders)))
           (uploader-requires (plist-get uploader-config <span style="color: #4c83ff;">:requires</span>))
           (uploader-help-info (plist-get uploader-config <span style="color: #4c83ff;">:help-info</span>))
           (uploader-template
            (org2web-file-to-string
             (org2web-get-uploader-template
              (<span style="color: #4c83ff;">or</span> (plist-get uploader-config <span style="color: #4c83ff;">:template</span>)
                  (concat (symbol-name uploader-name) <span style="color: #61CE3C;">".mustache"</span>)))))
           (uploader-template-settings
            (plist-get uploader-config <span style="color: #4c83ff;">:template-settings</span>)))
      (<span style="color: #4c83ff;">if</span> (not (member uploader-name uploader-names))
          (message (format <span style="color: #61CE3C;">"Uploader name %S in :remote is not recognized, please choice one from %S."</span>
                           uploader-name uploader-names))
        (<span style="color: #4c83ff;">if</span> (cl-some #'(lambda (x)
                         (not (executable-find x)))
                     uploader-requires)
            (message uploader-help-info)
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Generate uploader file</span>
          (org2web-string-to-file
           (mustache-render
            uploader-template
            (funcall uploader-template-settings <span style="color: #8B8989; font-style: italic;">; </span><span style="color: #8B8989; font-style: italic;">it's a function.</span>
                     remote export-dir history-dir publish-dir partial-update))
           uploader-file)
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Run Uploader file</span>
          (<span style="color: #4c83ff;">if</span> (<span style="color: #4c83ff;">and</span> (file-exists-p uploader-file)
                   (executable-find <span style="color: #61CE3C;">"bash"</span>))
              (<span style="color: #4c83ff;">cond</span>
               ((string-equal system-type <span style="color: #61CE3C;">"windows-nt"</span>)
                (w32-shell-execute <span style="color: #61CE3C;">"open"</span> (replace-regexp-in-string <span style="color: #61CE3C;">"/"</span> <span style="color: #61CE3C;">"\\"</span> uploader-file t t)))
               ((<span style="color: #4c83ff;">and</span> (string-equal system-type <span style="color: #61CE3C;">"gnu/linux"</span>)
                     org2web-terminal-emulater)
                (start-process-shell-command
                 <span style="color: #61CE3C;">"org2web-uploader-script"</span>
                 nil
                 (format <span style="color: #61CE3C;">"%s -e 'bash %s'"</span>
                         org2web-terminal-emulater
                         uploader-file))))
            (message <span style="color: #61CE3C;">"Can't run org2web uploader, user should install 'bash' correctly."</span>)))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-verify-configuration</span> ()
  <span style="color: #FBDE2D;">"Ensure all required configuration fields are properly configured, include:</span>
<span style="color: #FBDE2D;">1.  `</span><span style="color: #96CBFE;">:repository-directory</span><span style="color: #FBDE2D;">': &lt;required&gt;</span>
<span style="color: #FBDE2D;">2.  `</span><span style="color: #96CBFE;">:site-domain</span><span style="color: #FBDE2D;">': &lt;required&gt;</span>
<span style="color: #FBDE2D;">3.  `</span><span style="color: #96CBFE;">:personal-disqus-shortname</span><span style="color: #FBDE2D;">': &lt;optional&gt;</span>
<span style="color: #FBDE2D;">4.  `</span><span style="color: #96CBFE;">:personal-duoshuo-shortname</span><span style="color: #FBDE2D;">': &lt;optional&gt;</span>
<span style="color: #FBDE2D;">5.  `</span><span style="color: #96CBFE;">:site-main-title</span><span style="color: #FBDE2D;">': [optional] (but customization recommanded)</span>
<span style="color: #FBDE2D;">6.  `</span><span style="color: #96CBFE;">:site-sub-title</span><span style="color: #FBDE2D;">': [optional] (but customization recommanded)</span>
<span style="color: #FBDE2D;">7.  `</span><span style="color: #96CBFE;">:personal-github-link</span><span style="color: #FBDE2D;">': [optional] (but customization recommended)</span>
<span style="color: #FBDE2D;">8.  `</span><span style="color: #96CBFE;">:personal-google-analytics-id</span><span style="color: #FBDE2D;">': [optional] (but customization recommended)</span>
<span style="color: #FBDE2D;">9.  `</span><span style="color: #96CBFE;">:theme</span><span style="color: #FBDE2D;">': [optional]"</span>
  (<span style="color: #4c83ff;">unless</span> (member org2web-current-project
                  (mapcar 'car org2web-projects))
    (<span style="color: #ff69b4;">error</span> <span style="color: #61CE3C;">"Can't find project: \"%s\""</span> org2web-current-project))
  (<span style="color: #4c83ff;">let</span> ((repo-dir (org2web-get-repository-directory))
        (site-domain (org2web-get-site-domain)))
    (<span style="color: #4c83ff;">unless</span> (<span style="color: #4c83ff;">and</span> repo-dir (file-directory-p repo-dir))
      (<span style="color: #ff69b4;">error</span> <span style="color: #61CE3C;">"Repository directory is not properly configured."</span>))
    (<span style="color: #4c83ff;">unless</span> site-domain
      (<span style="color: #ff69b4;">error</span> <span style="color: #61CE3C;">"Site domain is not properly configured."</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-generate-readme</span> (save-dir)
  <span style="color: #FBDE2D;">"Generate README for `</span><span style="color: #96CBFE;">org2web-new-repository</span><span style="color: #FBDE2D;">'. SAVE-DIR is the directory where to</span>
<span style="color: #FBDE2D;">save generated README."</span>
  (org2web-string-to-file
   (concat
    (format <span style="color: #61CE3C;">"Personal site of %s, managed by emacs, org mode, git and org2web."</span>
            (<span style="color: #4c83ff;">or</span> user-full-name <span style="color: #61CE3C;">"[Author]"</span>))
    <span style="color: #61CE3C;">"\n\n"</span>
    <span style="color: #61CE3C;">"This git repository is generated by org2web \"org2web-new-repository\" \</span>
<span style="color: #61CE3C;">function, it is only used for demonstrating how the git branches and directory \</span>
<span style="color: #61CE3C;">structure are organized by org2web."</span>)
   (expand-file-name <span style="color: #61CE3C;">"README"</span> save-dir)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-generate-index</span> (save-dir)
  <span style="color: #FBDE2D;">"Generate index.org for `</span><span style="color: #96CBFE;">org2web-new-repository</span><span style="color: #FBDE2D;">'. SAVE-DIR is the directory where</span>
<span style="color: #FBDE2D;">to save generated index.org."</span>
  (org2web-string-to-file
   (concat <span style="color: #61CE3C;">"#+TITLE: Index"</span> <span style="color: #61CE3C;">"\n\n"</span>
           (format <span style="color: #61CE3C;">"This is the home page of %s."</span>
                   (<span style="color: #4c83ff;">or</span> user-full-name <span style="color: #61CE3C;">"[Author]"</span>)))
   (expand-file-name <span style="color: #61CE3C;">"index.org"</span> save-dir)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-generate-about</span> (save-dir)
  <span style="color: #FBDE2D;">"Generate about.org for `</span><span style="color: #96CBFE;">org2web-new-repository</span><span style="color: #FBDE2D;">'. SAVE-DIR is the directory where</span>
<span style="color: #FBDE2D;">to save generated about.org."</span>
  (org2web-string-to-file
   (concat <span style="color: #61CE3C;">"#+TITLE: About"</span> <span style="color: #61CE3C;">"\n\n"</span>
           (format <span style="color: #61CE3C;">"* About %s"</span> (<span style="color: #4c83ff;">or</span> user-full-name <span style="color: #61CE3C;">"[Author]"</span>)) <span style="color: #61CE3C;">"\n\n"</span>
           <span style="color: #61CE3C;">"  This file is automatically generated by org2web."</span>)
   (expand-file-name <span style="color: #61CE3C;">"about.org"</span> save-dir)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-insert-options-template</span> (<span style="color: #afd8af;">&amp;optional</span> title uri
                                                  keywords tags description)
  <span style="color: #FBDE2D;">"Insert a template into current buffer with information for exporting.</span>

<span style="color: #FBDE2D;">TITLE: the title of this post</span>
<span style="color: #FBDE2D;">URI: the uri of this post, usually looks like: /2013/12/27/the-post-title,</span>
<span style="color: #FBDE2D;">the following parameters could be used:</span>
<span style="color: #FBDE2D;">    %y: to represent the year of creation date</span>
<span style="color: #FBDE2D;">    %m: to represent the month of creation date</span>
<span style="color: #FBDE2D;">    %d: to represent the day of creation date</span>
<span style="color: #FBDE2D;">KEYWORDS: the keywords of this post, used by search engine</span>
<span style="color: #FBDE2D;">TAGS: the tags of this post, should be separated by comma and space</span>
<span style="color: #FBDE2D;">DESCRIPTION: the description of this post, it will be displayed in RSS feed</span>

<span style="color: #FBDE2D;">Note that this function does not verify the input parameters, it is users'</span>
<span style="color: #FBDE2D;">responsibility to guarantee these parameters are valid."</span>
  (<span style="color: #4c83ff;">interactive</span>
   (<span style="color: #4c83ff;">let*</span> ((i (read-string <span style="color: #61CE3C;">"Title: "</span>))
          (u (read-string <span style="color: #61CE3C;">"URI(%y, %m and %d can be used to represent year, \</span>
<span style="color: #61CE3C;">month and day): "</span> (<span style="color: #4c83ff;">unless</span> (string= i <span style="color: #61CE3C;">""</span>)
                    (format-spec <span style="color: #61CE3C;">"/%c/%y/%m/%d/%t"</span>
                                 `((?c . ,(org2web-get-config-option <span style="color: #4c83ff;">:default-category</span>))
                                   (?y . <span style="color: #61CE3C;">"%y"</span>)
                                   (?m . <span style="color: #61CE3C;">"%m"</span>)
                                   (?d . <span style="color: #61CE3C;">"%d"</span>)
                                   (?t . ,(org2web-encode-string-to-url i)))))))
          (k (read-string <span style="color: #61CE3C;">"Keywords(separated by comma and space [, ]): "</span>))
          (a (read-string <span style="color: #61CE3C;">"Tags(separated by comma and space [, ]): "</span>))
          (d (read-string <span style="color: #61CE3C;">"Description: "</span>)))
     (list i u k a d)))
  (<span style="color: #4c83ff;">if</span> (not (bolp)) (newline))
  (insert (format
           (replace-regexp-in-string
            <span style="color: #61CE3C;">"#\\+\\+"</span> <span style="color: #61CE3C;">"#+"</span>
            <span style="color: #61CE3C;">"# -*- coding: utf-8-unix; -*-</span>
<span style="color: #61CE3C;">#++TITLE:       %s</span>
<span style="color: #61CE3C;">#++AUTHOR:      %s</span>
<span style="color: #61CE3C;">#++EMAIL:       %s</span>
<span style="color: #61CE3C;">#++DATE:        %s</span>

<span style="color: #61CE3C;"># #++URI:         %s</span>
<span style="color: #61CE3C;"># #++KEYWORDS:    %s</span>
<span style="color: #61CE3C;"># #++TAGS:        %s</span>
<span style="color: #61CE3C;"># #++DESCRIPTION: %s</span>

<span style="color: #61CE3C;">#++LANGUAGE:    %s</span>
<span style="color: #61CE3C;">#++OPTIONS:     H:%d num:%s toc:%s \\n:%s ::%s |:%s ^:%s -:%s f:%s *:%s &lt;:%s</span>
<span style="color: #61CE3C;">"</span>)
           (<span style="color: #4c83ff;">if</span> (string= title <span style="color: #61CE3C;">""</span>) (buffer-name) title)
           (user-full-name)
           user-mail-address
           (format-time-string (substring (car org-time-stamp-formats) 1 -1))
           (<span style="color: #4c83ff;">if</span> (string= uri <span style="color: #61CE3C;">""</span>) <span style="color: #61CE3C;">"&lt;TODO: insert your uri here&gt;"</span> uri)
           (<span style="color: #4c83ff;">if</span> (string= keywords <span style="color: #61CE3C;">""</span>)
               <span style="color: #61CE3C;">"&lt;TODO: insert your keywords here&gt;"</span>
             keywords)
           (<span style="color: #4c83ff;">if</span> (string= tags <span style="color: #61CE3C;">""</span>) <span style="color: #61CE3C;">"&lt;TODO: insert your tags here&gt;"</span> tags)
           (<span style="color: #4c83ff;">if</span> (string= description <span style="color: #61CE3C;">""</span>)
               <span style="color: #61CE3C;">"&lt;TODO: insert your description here&gt;"</span>
             description)
           org-export-default-language
           7   <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Set default level to 7 instead of `</span><span style="color: #96CBFE; font-style: italic;">org-export-headline-levels</span><span style="color: #8B8989; font-style: italic;">'</span>
           nil <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">org-export-with-section-numbers</span>
           nil <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">org-export-with-toc</span>
           org-export-preserve-breaks
           <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">org-export-html-expand</span>
           org-export-with-fixed-width
           org-export-with-tables
           nil <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">org-export-with-sub-superscripts</span>
           nil <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">org-export-with-special-strings</span>
           org-export-with-footnotes
           org-export-with-emphasize
           org-export-with-timestamps)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">org2web-new-post</span> (<span style="color: #afd8af;">&amp;optional</span> project-name category filename insert-fallback-template)
  <span style="color: #FBDE2D;">"Setup a new post.</span>

<span style="color: #FBDE2D;">PROJECT-NAME: which project do you want to export</span>
<span style="color: #FBDE2D;">CATEGORY:     this post belongs to</span>
<span style="color: #FBDE2D;">FILENAME:     the file name of this post</span>

<span style="color: #FBDE2D;">Note that this function does not verify the category and filename, it is users'</span>
<span style="color: #FBDE2D;">responsibility to guarantee the two parameters are valid."</span>
  (<span style="color: #4c83ff;">interactive</span>
   (<span style="color: #4c83ff;">let*</span> ((p (org2web-select-project <span style="color: #61CE3C;">"Which project do you want post? "</span>))
          (c (read-string (format <span style="color: #61CE3C;">"Category of \"%s\" project: "</span> p)
                          (org2web-get-config-option <span style="color: #4c83ff;">:default-category</span>)))
          (f (read-string (format <span style="color: #61CE3C;">"Filename of \"%s\" project: "</span> p) <span style="color: #61CE3C;">"new-post.org"</span> p))
          (d (yes-or-no-p <span style="color: #61CE3C;">"Insert fallback template? "</span>)))
     (list p c f d)))
  (<span style="color: #4c83ff;">if</span> (string= category <span style="color: #61CE3C;">""</span>)
      (<span style="color: #4c83ff;">setq</span> category (org2web-get-config-option <span style="color: #4c83ff;">:default-category</span>)))
  (<span style="color: #4c83ff;">if</span> (string= filename <span style="color: #61CE3C;">""</span>)
      (<span style="color: #4c83ff;">setq</span> filename <span style="color: #61CE3C;">"new-post.org"</span>))
  (<span style="color: #4c83ff;">unless</span> (org2web-string-suffix-p <span style="color: #61CE3C;">".org"</span> filename)
    (<span style="color: #4c83ff;">setq</span> filename (concat filename <span style="color: #61CE3C;">".org"</span>)))
  (<span style="color: #4c83ff;">let*</span> ((repo-dir (org2web-get-repository-directory))
         (dir (concat (file-name-as-directory repo-dir)
                      (file-name-as-directory category)))
         (path (concat dir filename)))
    (<span style="color: #4c83ff;">if</span> (file-exists-p path)
        (<span style="color: #ff69b4;">error</span> <span style="color: #61CE3C;">"Post `</span><span style="color: #96CBFE;">%s</span><span style="color: #61CE3C;">' already exists."</span> path))
    (<span style="color: #4c83ff;">unless</span> (file-directory-p dir)
      (mkdir dir t))
    (switch-to-buffer (find-file path))
    (<span style="color: #4c83ff;">if</span> (<span style="color: #4c83ff;">and</span> (not insert-fallback-template)
             (called-interactively-p 'any))
        (call-interactively 'org2web-insert-options-template)
      (org2web-insert-options-template <span style="color: #61CE3C;">"&lt;Insert Your Title Here&gt;"</span>
                                       (format <span style="color: #61CE3C;">"/%s/%%y/%%m/%%d/%%t/ Or /%s/%%t/"</span>
                                               category category)
                                       <span style="color: #61CE3C;">"keyword1, keyword2, keyword3"</span>
                                       <span style="color: #61CE3C;">"tag1, tag2, tag3"</span>
                                       <span style="color: #61CE3C;">"&lt;Add description here&gt;"</span>))
    (save-buffer)))
</pre>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2017-08-09</span>
        <span title="last modification date" class="post-info">2017-08-09</span>
        <span title="tags" class="post-info">N/A</span>
        <span title="author" class="post-info">Feng Shu</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div class="ds-thread" data-thread-key="5c00b01e9a8ba0c9f70425c55a72d84f"
                               data-title="static site generator based on org mode" data-url="http://tumashu.github.com/org2web/documents/static-site-generator-based-on-org-mode/"></div>
        <script type="text/javascript">
        var duoshuoQuery = {short_name:"tumashu-website"};
	    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	    })();
	    </script>
      </section>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; <span id="footerYear"></span> <a href="mailto:tumashu &lt;at&gt; 163 &lt;dot&gt; com">Feng Shu</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/tumashu/org2web" target="_blank">org2web</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

</div>
</body>
</html>
